<?xml version="1.0" encoding="utf-8"?>
<template_modifications>
  <modification modification_key="wf_login_cache_reload"
               addon_id="WindowsForum/SessionValidator"
               type="public"
               template="PAGE_CONTAINER"
               description="Reload stale cached guest pages after login"
               execution_order="10"
               enabled="1"
               action="str_replace">
    <find><![CDATA[<meta charset="utf-8" />]]></find>
    <replace><![CDATA[<meta charset="utf-8" />
<xf:if is="!$xf.visitor.user_id"><script>!function(){var p=document.documentElement.getAttribute("data-cookie-prefix")||"xf_";if(document.cookie.indexOf(p+"ls=")!==-1){var d=document.documentElement,dark=d.getAttribute("data-color-scheme")==="dark";d.style.cssText="visibility:hidden!important;overflow:hidden!important;background:"+(dark?"#202122":"#eff5f6")+"!important";location.reload()}}()</script></xf:if>]]></replace>
  </modification>
  <modification modification_key="wf_style_cache_reload"
               addon_id="WindowsForum/SessionValidator"
               type="public"
               template="PAGE_CONTAINER"
               description="Reload stale cached pages after style/variation change (Safari fallback)"
               execution_order="11"
               enabled="1"
               action="str_replace">
    <find><![CDATA[<meta charset="utf-8" />]]></find>
    <replace><![CDATA[<meta charset="utf-8" />
<script>!function(){var p=document.documentElement.getAttribute("data-cookie-prefix")||"xf_",c=p+"sc=";if(document.cookie.indexOf(c)!==-1){document.cookie=c+";path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT";var d=document.documentElement,dark=d.getAttribute("data-color-scheme")==="dark";d.style.cssText="visibility:hidden!important;overflow:hidden!important;background:"+(dark?"#202122":"#eff5f6")+"!important";location.reload()}}()</script>]]></replace>
  </modification>
</template_modifications>
